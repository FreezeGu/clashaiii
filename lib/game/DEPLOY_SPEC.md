# Система деплоя (Deploy): зоны, руины, pocket — как в Clash Royale

Скрытая тайловая сетка 18×32. Клики/тач конвертируются в тайл (snapping). Визуал может быть гладким, логика — строго тайловая.

---

## 1. Типы деплоя: Troop / Building / Spell

### Troops (войска)
- Точка размещения в **территории деплоя** (база + руины + pocket при открытом лейне).
- Тайл не вода, не мост, не статический blocked (площадка живой башни).
- **Войска не блокируют деплой друг другу** — проверка «занято юнитом» не выполняется (допускается «наслаивание» по спавну).

### Buildings (здания)
- Все тайлы **footprint** (3×3 или 2×2) в территории деплоя.
- Ни один тайл footprint не пересекается с: живыми башнями, другими зданиями, водой, мостами, статическими зонами.
- **PLACEMENT_BUFFER = 0** — можно ставить вплотную к башне (edge-adjacent), без зазора.

### Spells (заклинания)
- Можно кастовать в **любую точку** арены (включая реку/мост/территорию врага).
- Опционально: snapping к центру тайла.

---

## 2. Территория деплоя (Deploy Territory Mask)

### Базовая территория
- Игрок: своя половина (до реки), screen rows 17..31.
- Враг (бот): своя половина, rows 0..14.

### Руины (после разрушения своей башни)
- Footprint башни переводится в **0** (ground): placeable, walkable.
- Визуал: спрайт/декаль «руины», без геймплейной блокировки.
- **Acceptance:** после уничтожения своей башни можно ставить troop/building на область бывшей башни.

### Pocket (после сноса вражеской принцесс-башни)
- Событие: `OnPrincessTowerDestroyed(owner=Enemy, lane=Left|Right)`.
- Эффект: `pocketEnabled[Attacker][lane] = true`.
- Геометрия:
  - **LEFT_LANE:** X ∈ [0 .. 8]
  - **RIGHT_LANE:** X ∈ [9 .. 17]
  - **POCKET_DEPTH** = floor(32/3) = 10.
  - Враг сверху: pocket = rows 0..9 в соответствующем лейне.
  - Враг снизу: pocket = rows 22..31 в соответствующем лейне.
- Сломана только левая башня → pocket только слева; только правая → только справа; обе → pocket с двух сторон.

**Acceptance:** сломал левую башню врага → можно деплоить в pocket слева, но не справа.

---

## 3. Нулевой буфер у башен

- **PLACEMENT_BUFFER = 0.** Запрет только при пересечении footprint.
- Можно ставить troop на тайл, соседний с башней по стороне.
- Можно ставить building так, что footprint касается footprint башни ребром, но не пересекается.

---

## 4. Debug-режим

Переключатель (например `?debug=1`) показывает:
- границы деплой-зон (база + pocket);
- недоступные тайлы (blocked, вода);
- footprint башен (живые = красный tint);
- pocket-зоны (другой tint, например синий).

Реализация: `showDebugOverlay` в `battle-canvas`, функции `isInDeployTerritory`, `isInPocket`, `getLiveTowerFootprintCells` в `arena.ts` / `battle-engine.ts`.
