# Crown Rivals

An original **lane-based tower battler** for the web. Deploy units, manage elixir, destroy towers—and upgrade your **AI** (not stats) to outsmart opponents.

## Quick start

```bash
npm install
npm run generate:assets   # optional: creates placeholder art in public/assets
npm run dev
```

Open http://localhost:3000. Build for production:

```bash
npm run build
```

Output is in `/dist`.

## Project structure

- **`/src`** – Game and app code
  - **`scenes/`** – Boot, Preload, MainMenu, Deck, Store, Battle, Results
  - **`sim/`** – Simulation: entities, pathfinding (A*), combat, elixir, card cycle, unit AI, bot commander
  - **`data/`** – Cards, `aiProfiles.json`, `botProfiles.json`, strings
  - **`state/`** – Player profile and localStorage persistence
  - **`ui/`** – Luxury theme (colors, typography)
- **`/public/assets`** – Art and SFX (generated by `npm run generate:assets`)
- **`/tools`** – `generatePlaceholders.ts`, `trainAI.ts`

## How to play

1. **Main menu** – Tap **BATTLE** (Battaglia) to start a match. Use **Mazzo** (Deck) and **Negozio** (Store) in the bottom bar.
2. **Deck** – Build a deck of 6–8 cards. Each card has an **AI level** (1–10). Upgrading only improves unit and bot behavior, not HP/damage.
3. **Store** – Spend gold on Card Crate, AI Training Manual, Daily Deal (in-game currency only).
4. **Battle** – Drag a card from your hand onto **your half** of the arena (bottom). Elixir regenerates over time. Destroy Crown Towers for 1 crown each; destroy the King Tower for instant win (3 crowns). Match lasts 3:00; crowns decide the winner.

## AI levels (the twist)

- **Card level = AI level** (1–10). Stats (HP, damage, etc.) are fixed per unit type.
- Upgrading improves:
  - **Unit micro-AI** – Targeting, pathfinding, reaction speed, kiting, focus fire (tuned via `src/data/aiProfiles.json`).
  - **Bot commander** – Card choice, placement, timing (tuned via `src/data/botProfiles.json` and trophy tier).
- Tiers 1–3: weak reactions, random-ish. 4–6: better priorities, basic strategy. 7–10: predictive targeting, tower protection, counterplay.

## Tuning and training

- **`src/data/aiProfiles.json`** – Per-level weights: `reactionDelayMs`, `targetPriorityWeights`, `pathReplanIntervalMs`, etc.
- **`src/data/botProfiles.json`** – Trophy ranges, deck pools, `reactionDelayMs`, `mistakeRate`, `commanderWeights`.
- **Offline training** (optional):
  ```bash
  npm run train:ai
  ```
  Runs bot-vs-bot, mutates weights, writes `src/data/aiProfiles.trained.json`. Configure the game to use the trained file if present.

## Scripts

| Script | Description |
|--------|-------------|
| `npm run dev` | Start Vite dev server |
| `npm run build` | TypeScript + Vite build → `/dist` |
| `npm run preview` | Preview production build |
| `npm run generate:assets` | Generate placeholder PNGs (and dirs) in `public/assets` |
| `npm run train:ai` | Self-play training → `aiProfiles.trained.json` |
| `npm run test` | Run Vitest (card cycle, A*, RNG, AI scoring) |
| `npm run lint` | ESLint |
| `npm run format` | Prettier |

## Tech stack

- **Vite** + **TypeScript**
- **Phaser 3** – Rendering, input, audio, animations
- **Vitest** – Unit tests for sim logic
- **localStorage** – Profile, trophies, deck, owned cards, AI levels, gold
- **Inter** font (via Google Fonts in `index.html`)

## License

Original game and assets. No trademarked names or copied art.
